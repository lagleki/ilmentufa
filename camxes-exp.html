<!doctype html>
<html>
<body>
<meta charset='utf-8' />

<span style="font: 15px arial, sans-serif;">Type any Lojban text in the following textarea. The result will be parsed as you type:</span>
<br /><br />

<form id="form1" name="form1" method="post" action="" style="width:100%">
  <textarea id="input_textarea" style="width:100%" rows="8" autofocus></textarea>
  <br />
  <span style="font: 15px arial, sans-serif;">Output mode: </span>
  <!--
			"  .i zo'oi  +brackets  noi ditfaulte zo'u lo te pruce cu se melgau je nai cu se fanva\n" +
			"  .i zo'oi  +gloss                   zo'u lo skami cu spoja\n" + //te pruce cu gloso fi lo glibau (to na sai bredi toi)\n" +
			"  .i zo'oi  +raw                     zo'u lo te pruce na se melgau\n" +
			"  .i zo'oi  +s                       zo'u lo cmene be lo selma'o cu pagbu\n" +
			"  .i zo'oi  +f         noi ditfaulte zo'u lo famyma'o poi jai se rivbi cu pagbu\n" +
			"  .i zo'oi  +p                       zo'u lo tersumpoi pe lo selbrisle cu pagbu\n" +
			"  .i zo'oi  +voi       noi ditfaulte zo'u zo voi cmavo ma'oi nu je nai ma'oi noi\n" +
			"  .i zo'oi  +ckt                     zo'u ro mei'e  zo ce joi zo ce'u  zo ki joi zo ke'a  zo tau joi zo tu'a\n" +
			"                                          cu voi lo se gunma be ke'a cu bastysi \n" +
			"  .i zo'oi  +du                      zo'u zo du jo'u zo du'u bastysi\n" +
			"  .i zo'oi  +su                      zo'u zo su jo'u zo su'o bastysi .i ma'oi su se cmene zo su'o\n" +
			"  .i zo'oi  +buhu      noi ditfaulte zo'u ro mei'e zo bu zo bu'u zo zai cu cmavo lo fadni\n" +
			"  .i zo'oi  +bu                      zo'u zo bu jo'u zo bu'u bastysi\n" +
			"  .i zo'oi  +zai                     zo'u zo zai cmavo ma'oi pu je nai ma'oi lau ja bo ma'oi ce'a\n" +
			"  .i zo'oi  +po                      zo'u ma'oi lo'oi se cmene zo po noi cmavo vo'a je nai ma'oi goi\n" +
			"                                          .i je ma'oi ku'au se cmene zo po'e noi cmavo vo'a je nai ma'oi goi \n" +
			"  .i zo'oi  +koi                     zo'u zo koi cmavo ma'oi ui je nai ma'oi pu\n" +
			"  .i zo'oi  +lau                     zo'u zo lau cmavo ma'oi ko'a je nai ma'oi lau noi se cmene zo ce'a\n" +
			"  .i zo'oi  +lerfu                   zo'u na ka'e ku su'o lerpoi cu se pagbu ge su'o vlale'u gi su'o nacle'u \n" +
			"  .i zo'oi  +diftogoteha             zo'u zo si'u cmavo ma'oi ui je nai ma'oi pu\n" +
			"                                          .i je zo di'o cmavo ma'oi coi je nai ma'oi pu \n" +
			"                                          .i je zo se'e cmavo ma'oi ko'a je nai ma'oi by \n" +
			"  .i zo'oi  +cktj                    zo'u dunli lo nu pilno ro mei'e zo'oi voi zo'oi ckt zo'oi du zo'oi su\n" +
			"                                                                     zo'oi zai zo'oi lau zo'oi po zo'oi koi \n" +
			"  .i zo'oi  +zaho                    zo'u dunli lo nu pilno zo'oi cktj je zo'oi diftogoteha\n" +
  -->
  <script>
        
    
      
  </script>
  <select id="optlist" onChange="run_camxes()">
    <option>Raw output</option>
    <option>Condensed</option>
    <option id="default">Prettified</option>
    <option>Prettified + selmaho</option>
    <option>Prettified + sm ext</option>
    <option>Prettified --fm</option>
    <option>Prettified --fm + selmaho</option>
    <option>Prettified --fm + sm ext</option>
  </select>
  <table
  <span style="padding-left: 32px; text-align: right; font-size: 12px;">
    <a href="camxes-exp.js.peg" target="_blank">[ Grammar file ]</a>
  </span>
  <span style="padding-left: 24px; text-align: right; font-size: 12px;">
    <a href="camxes.html">[ Switch to standard grammar ]</a>
  </span>
</form>

<div style="display:block; overflow: scroll; max-height:24em; border: solid 1px; padding: 10px; background-color: #DDDDFF;"
     height="24em">
  <pre style="white-space: pre-wrap;"><code id="parse_result" width="100%" height="100%"> </code></pre>
</div>

<script type="text/javascript" src="camxes-exp.js"></script>
<script type="text/javascript" src="camxes_preproc.js"></script>
<script type="text/javascript" src="ilmentufa_options.js"></script>
<script type="text/javascript" src="ilmentufa_postproc.js"></script>

<script>
var options = JSON.parse(JSON.stringify(ret));
function toggle(name, key) {
  return {
    name: name,
    get: function () { return options[key] },
    set: function (value) { options[key] = value },
  };
}
function not(toggle) {
  return {
    get: function () { return !toggle.get() },
    set: function (value) { toggle.set(!value) },
  }
}
var output_checks = [
  {name: "lo te pruce cu fegli", get: function () { return options.format == "raw" }, 
                      set: function (value) { options.format = value ? "raw" : "brackets" },},
  toggle("viska lo selma'o cmene", "s"),
  toggle("viska lo se rivbi famyma'o", "f"),
  toggle("viska lo srana be ma'oi se", "p"),
];
var c_voi = toggle("zo voi cmavo ma'oi nu"),
    c_ckt = toggle("lo'u ce ce'u ki ke'a tau tu'a le'u zo'u basti"),
    c_du = toggle("zo du jo'u zo du'u bastysi"),
    c_su = toggle("zo su jo'u zo su'o bastysi"),
    c_buhu = {name: "zo bu'u zo bu zo zai zo'u fadni", get: function () { return options.buhu == "buhu" },
              set: function (value) { if (value) options.buhu = "buhu" },},
    c_bu = {name: "zo bu jo'u zo bu'u bastysi", get: function () { return options.buhu == "bu" },
              set: function (value) { if (value) options.buhu = "bu" },},
    c_zai = {name: "zo zai cmavo ma'oi pu", get: function () { return options.buhu == "zai" },
              set: function (value) { if (value) options.buhu = "zai" },},
    c_po = toggle("lo'u po po'e le'u dunli lu xu'u ku'au li'u"),
    c_koi = toggle("zo koi cmavo ma'oi ui"),
    c_lau = toggle("zo lau cmavo ma'oi ko'a"),
    c_lerfu = toggle("ro lerpoi zo'u pa da lerkle"),
    c_diftogoteha = toggle("lo clani cmavo cu se terpa");
var micro_checks = [c_voi, c_ckt, c_du, c_buhu, c_bu, c_zai, c_po, c_koi, c_lau, c_lerfu, c_diftogoteha];
var c_fadni = {name: "fadni jbobau", 
               conds: [c_voi, c_ckt, c_du, c_su, c_bu, c_zai, c_po, c_koi, c_lau, c_lerfu, c_diftogoteha],
               get: function () { return conds.all(function (a) { return !a.get() }) },
               set: function (a) { if (a) { conds.forEach(function (b) { b.set(false) }); c_buhu.set(true) } },},
    c_cekti = {name: "cetkitaujbo", 
               conds: [c_voi, c_ckt, c_du, c_su, c_zai, c_po, c_koi, c_lau, not(c_lerfu), not(c_diftogoteha)],
               get: function () { return conds.all(function (a) { return a.get() }) },
               set: function (a) { if (a) { conds.forEach(function (b) { b.set(true) }) } },},
    /*c_xorxo = {name: "xorjbo", 
               conds: [c_voi, c_ckt, c_du, c_su, c_zai, c_po, c_koi, c_lau],
               get: function () { return conds.all(function (a) { return a.get() }) },
               set: function (a) { if (a) { conds.forEach(function (b) { b.set(true) }) } },},*/
    c_djemu = {name: "djemyjbo", 
               conds: [c_cetki, c_diftogoteha, not(c_lerfu)],
               get: function () { return conds.all(function (a) { return a.get() }) },
               set: function (a) { if (a) { conds.forEach(function (b) { b.set(true) }) } },};



document.querySelector('#input_textarea').keyup = function () {
  run_camxes();
};

function run_camxes() {
    try {
      var input = document.querySelector('#input_textarea').value;
      input = camxes_preprocessing(input);
      var result = camxes.parse(input);
    } catch (e) {
      document.querySelector('#parse_result').textContent = e.toString();
      return;
    }
    var result_str = JSON.stringify(result, undefined, 2);
    /* We get the output mode selected in the combobox */
    var mode = document.getElementById("optlist").selectedIndex;
    /* Postprocessing â€” if mode == 0, the below function won't modify camxes' output */
    result_str = camxes_postprocessing(result_str, mode);  // @camxes_postproc.js
    /* Retrieve the result */
    document.querySelector('#parse_result').textContent = result_str;
}
</script>

</body>
</html>

